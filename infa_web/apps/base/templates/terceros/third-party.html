{%extends 'layouts/base.html'%}
{% block content_head %}
	<link rel="stylesheet" href="https://cdn.rawgit.com/Eonasdan/bootstrap-datetimepicker/e8bddc60e73c1ec2475f827be36e1957af72e2ea/build/css/bootstrap-datetimepicker.css">
{% endblock content_head %}
{%block content%}
	{%include 'elements/nav.html'%}
	{%include 'elements/sidebar.html'%}
	<div class="content-wrapper" style="min-height: 921px;">
		<div class="content">
			<h2>Terceros</h2>
			<ul class="nav nav-pills">
				<li class="active"><a data-toggle="pill" href="#tabBasicos">Basicos</a></li>
				<li><a data-toggle="pill" href="#tabLegales">Legales</a></li>
				<li><a data-toggle="pill" href="#tabOtros">Otros</a></li>
			</ul>
			
			<form action="" method="POST" role="form" class="form-horizontal">
				{%csrf_token%}
				<div class="tab-content">
					<div id="tabBasicos" class="tab-pane  active">
						<div class="box box-primary">
							<div class="box-header with-border">
								<h3 class="box-title">Basicos</h3>
							</div>
							<div class="box-body">
								<div class="form-group">
									<label for="{{form.cpersona.id_for_label}}" class="col-sm-2 control-label">{{form.cpersona.label}}</label>
									{%if form.cpersona.errors%}
									{{form.cpersona.errors}}
									{%endif%}
									<div class="col-sm-10">
										<div class="input-group">
											{{form.cpersona}}
											<span class="input-group-addon"><a data-new-window href="" target="_blank"><i class="fa fa-plus-square"></i></a></span>
										</div>
									</div>
								</div>
								
								<div class="col-md-6 form-group">
									<label for="{{form.ape1.id_for_label}}" class="col-sm-4 control-label">{{form.ape1.label}}</label>
									{%if form.ape1.errors%}
									{{form.ape1.errors}}
									{%endif%}
									<div class="col-sm-8">
										{{form.ape1}}
									</div>
								</div>
								<div class="col-md-6 form-group">
									<label for="{{form.ape2.id_for_label}}" class="col-sm-4 control-label">{{form.ape2.label}}</label>
									{%if form.ape2.errors%}
									{{form.ape2.errors}}
									{%endif%}
									<div class="col-sm-8">
										{{form.ape2}}
									</div>
								</div>



								<div class="col-md-6 form-group">
									<label for="{{form.nom1.id_for_label}}" class="col-sm-4 control-label">{{form.nom1.label}}</label>
									{%if form.nom1.errors%}
									{{form.nom1.errors}}
									{%endif%}
									<div class="col-sm-8">
										{{form.nom1}}
									</div>
								</div>
								<div class="col-md-6 form-group">
									<label for="{{form.nom2.id_for_label}}" class="col-sm-4 control-label">{{form.nom2.label}}</label>
									{%if form.nom2.errors%}
									{{form.nom2.errors}}
									{%endif%}
									<div class="col-sm-8">
										{{form.nom2}}
									</div>
								</div>

								<div class="row">
									<div class="form-group col-md-6">
										<label for="{{form.rasocial.id_for_label}}" class="col-sm-4 control-label">{{form.rasocial.label}}</label>
										{%if form.rasocial.errors%}
										{{form.rasocial.errors}}
										{%endif%}
										<div class="col-sm-8">
											{{form.rasocial}}
										</div>
									</div>
									<div class="form-group col-md-6">
										<label for="{{form.nomcomer.id_for_label}}" class="col-sm-4 control-label">{{form.nomcomer.label}}</label>
										{%if form.nomcomer.errors%}
										{{form.nomcomer.errors}}
										{%endif%}
										<div class="col-sm-8">
											{{form.nomcomer}}
										</div>
									</div>
								</div>

								<div class="col-md-4 form-group">
									<label for="{{form.idterce.id_for_label}}" class="col-sm-4 control-label">{{form.idterce.label}}</label>
									{%if form.idterce.errors%}
									{{form.idterce.errors}}
									{%endif%}
									<div class="col-sm-8">
										{{form.idterce}}
									</div>
								</div>
								<div class="col-md-2 form-group">
									<label for="{{form.dv.id_for_label}}" class="col-sm-6 control-label">{{form.dv.label}}</label>
									{%if form.dv.errors%}
									{{form.dv.errors}}
									{%endif%}
									<div class="col-sm-6">
										{{form.dv}}
									</div>
								</div>
								<div class="col-md-6 form-group">
									<label for="{{form.ctiide.id_for_label}}" class="col-sm-4 control-label">{{form.ctiide.label}}</label>
									{%if form.ctiide.errors%}
									{{form.ctiide.errors}}
									{%endif%}
									<div class="col-sm-8">
										<div class="input-group">
											{{form.ctiide}}
											<span class="input-group-addon"><a data-new-window href="{% url 'add-id-type' %}" target="_blank"><i class="fa fa-plus-square"></i></a></span>
										</div>
									</div>
								</div>
								
								<div class="row">
									<div class="col-sm-4 form-group">
										<label for="{{form.dirterce.id_for_label}}" class="col-md-4 control-label">{{form.dirterce.label}}</label>
										{%if form.dirterce.errors%}
										{{form.dirterce.errors}}
										{%endif%}
										<div class="col-sm-8">
											{{form.dirterce}}
										</div>
									</div>
									<div class="col-sm-4 form-group">
										<label for="{{form.telterce.id_for_label}}" class="col-md-4 control-label">{{form.telterce.label}}</label>
										{%if form.telterce.errors%}
										{{form.telterce.errors}}
										{%endif%}
										<div class="col-sm-8">
											{{form.telterce}}
										</div>
									</div>
									<div class="col-sm-4 form-group">
										<label for="{{form.faxterce.id_for_label}}" class="col-md-4 control-label">{{form.faxterce.label}}</label>
										{%if form.faxterce.errors%}
										{{form.faxterce.errors}}
										{%endif%}
										<div class="col-sm-8">
											{{form.faxterce}}
										</div>
									</div>
								</div>

								<div class="row">
									<div class="form-group col-md-4">
										<label for="{{form.cesdo.id_for_label}}" class="col-sm-4 control-label">{{form.cesdo.label}}</label>
										{%if form.cesdo.errors%}
										{{form.cesdo.errors}}
										{%endif%}
										<div class="col-sm-8">
											<div class="input-group">
												{{form.cesdo}}
												<span class="input-group-addon"><a data-new-window href="{% url 'add-state' %}" target="_blank"><i class="fa fa-plus-square"></i></a></span>
											</div>
										</div>
									</div>
									<div class="form-group col-md-4">
										<label for="{{form.ciudad.id_for_label}}" class="col-sm-4 control-label">{{form.ciudad.label}}</label>
										{%if form.ciudad.errors%}
										{{form.ciudad.errors}}
										{%endif%}
										<div class="col-sm-8">
											<div class="input-group">
												{{form.ciudad}}
												<span class="input-group-addon"><a data-new-window href="{% url 'add-city' %}" target="_blank"><i class="fa fa-plus-square"></i></a></span>
											</div>
										</div>
									</div>
									<div class="form-group col-md-4">
										<label for="{{form.email.id_for_label}}" class="col-sm-4 control-label">{{form.email.label}}</label>
										{%if form.email.errors%}
										{{form.email.errors}}
										{%endif%}
										<div class="col-sm-8">
											{{form.email}}
										</div>
									</div>
								</div>
	
							</div>
						</div>
					</div>

					<div id="tabLegales" class="tab-pane ">
						<div class="box box-primary">
							<div class="box-header with-border">
								<h3 class="box-title">Legales</h3>
							</div>
							<div class="box-body">
								
								<div class="form-group">
									<label for="{{form.replegal.id_for_label}}" class="col-sm-2 control-label">{{form.replegal.label}}</label>
									{%if form.replegal.errors%}
									{{form.replegal.errors}}
									{%endif%}
									<div class="col-sm-10">
										{{form.replegal}}
									</div>
								</div>
								<div class="form-group">
									<label for="{{form.sigla.id_for_label}}" class="col-sm-2 control-label">{{form.sigla.label}}</label>
									{%if form.sigla.errors%}
									{{form.sigla.errors}}
									{%endif%}
									<div class="col-sm-10">
										{{form.sigla}}
									</div>
								</div>
								<div class="form-group">
									<label for="{{form.cregiva.id_for_label}}" class="col-sm-2 control-label">{{form.cregiva.label}}</label>
									{%if form.cregiva.errors%}
									{{form.cregiva.errors}}
									{%endif%}
									<div class="col-sm-10">
										<div class="input-group">
											{{form.cregiva}}
											<span class="input-group-addon"><a data-new-window href="{% url 'add-reg-iva' %}" target="_blank"><i class="fa fa-plus-square"></i></a></span>
										</div>
									</div>
								</div>
								<div class="form-group">
									<label for="{{form.cautorre.id_for_label}}" class="col-sm-2 control-label">{{form.cautorre.label}}</label>
									{%if form.cautorre.errors%}
									{{form.cautorre.errors}}
									{%endif%}
									<div class="col-sm-10">
										<div class="input-group">
											{{form.cautorre}}
											<span class="input-group-addon"><a data-new-window href="{% url 'add-autorretenedor' %}" target="_blank"><i class="fa fa-plus-square"></i></a></span>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>

					<div id="tabOtros" class="tab-pane ">
						<div class="box box-primary">
							<div class="box-header with-border">
								<h3 class="box-title">Otros</h3>
							</div>
							<div class="box-body">
								<div class="col-md-4 form-group">
									<label for="{{form.czona.id_for_label}}" class="col-sm-4 control-label">{{form.czona.label}}</label>
									{%if form.czona.errors%}
									{{form.czona.errors}}
									{%endif%}
									<div class="col-sm-8">
										<div class="input-group">
											{{form.czona}}
											<span class="input-group-addon"><a data-new-window href="{% url 'add-zone' %}" target="_blank"><i class="fa fa-plus-square"></i></a></span>
										</div>
									</div>
								</div>
								<div class="col-md-4 form-group">
									<label for="{{form.cruta.id_for_label}}" class="col-sm-4 control-label">{{form.cruta.label}}</label>
									{%if form.cruta.errors%}
									{{form.cruta.errors}}
									{%endif%}
									<div class="col-sm-8">
										<div class="input-group">
											{{form.cruta}}
											<span class="input-group-addon"><a data-new-window href="{% url 'add-route' %}" target="_blank"><i class="fa fa-plus-square"></i></a></span>
										</div>
									</div>
								</div>
								<div class="col-md-4 form-group">
									<label for="{{form.ordenruta.id_for_label}}" class="col-sm-4 control-label">{{form.ordenruta.label}}</label>
									{%if form.ordenruta.errors%}
									{{form.ordenruta.errors}}
									{%endif%}
									<div class="col-sm-8">
										{{form.ordenruta}}
									</div>
								</div>
								
								<div class="form-group">
									<label for="{{form.cvende.id_for_label}}" class="col-sm-2 control-label">{{form.cvende.label}}</label>
									{%if form.cvende.errors%}
									{{form.cvende.errors}}
									{%endif%}
									<div class="col-sm-10">
										<div class="input-group">
											{{form.cvende}}
											<span class="input-group-addon"><a data-new-window href="" target="_blank"><i class="fa fa-plus-square"></i></a></span>
										</div>
									</div>
								</div>
								<div class="row">
									<div class="form-group col-md-6">
										<label for="{{form.topcxc.id_for_label}}" class="col-sm-4 control-label">{{form.topcxc.label}}</label>
										{%if form.topcxc.errors%}
										{{form.topcxc.errors}}
										{%endif%}
										<div class="col-sm-8">
											{{form.topcxc}}
										</div>
									</div>
									<div class="form-group col-md-6">
										<label for="{{form.clipre.id_for_label}}" class="col-sm-4 control-label">{{form.clipre.label}}</label>
										{%if form.clipre.errors%}
										{{form.clipre.errors}}
										{%endif%}
										<div class="col-sm-8">
											{{form.clipre}}
										</div>
									</div>
								</div>
								<div class="row">
									<div class="form-group col-md-6">
										<label for="{{form.contacto.id_for_label}}" class="col-sm-4 control-label">{{form.contacto.label}}</label>
										{%if form.contacto.errors%}
										{{form.contacto.errors}}
										{%endif%}
										<div class="col-sm-8">
											{{form.contacto}}
										</div>
									</div>
									<div class="form-group col-md-6">
										<label for="{{form.fnaci.id_for_label}}" class="col-sm-4 control-label">{{form.fnaci.label}}</label>
										{%if form.fnaci.errors%}
										{{form.fnaci.errors}}
										{%endif%}
										<div class="col-sm-8">
											{{form.fnaci}}
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="btn-group">
					<button class="btn btn-app btn-info" type="reset">
						<i class="fa fa-plus-square-o"></i>Nuevo
					</button>
					<button class="btn btn-app" type="submit">
						<i class="fa fa-plus-square-o"></i>Guardar
					</button>
					<a data-new-window class="btn btn-app" href="{% url 'list-third-parties' %}"><i class="fa fa-list"></i>Listar</a>
				</div>
			</form>
		</div>
	</div>
	{%include 'elements/footer.html'%}
{%endblock%}
{% block content_script %}
	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment-with-locales.js"></script>
	<script src="https://cdn.rawgit.com/Eonasdan/bootstrap-datetimepicker/e8bddc60e73c1ec2475f827be36e1957af72e2ea/src/js/bootstrap-datetimepicker.js"></script>
	<script>
		$("[name={{form.idterce.name}}]").change(function(){
			var element = $(this)
			$.ajax({
				url: '{% url 'api-exists' %}',
				type: 'POST',
				data: JSON.stringify({
					'model': 29,
					'field': this.name,
					'value': this.value
				}),
				contentType: "application/json",
				success: function(response){
					if (response.exists){
						var container = element.closest(".form-group");

						container.attr("title","<span class='html_tooltip'>Esta Idendificaci√≥n ya se encuentra registrada.</span>");
						container.tooltip({trigger:"focus",placement:"bottom",html:true});
						container.tooltip("show");
						window.setTimeout(function(){
							container.tooltip("destroy");
						},3000);
					}
				}
			});
		})
		$("[name=ape1],[name=ape2],[name=nom1],[name=nom2]").on("change",setRasocial);
		function setRasocial(){
			$("[name=rasocial]").val($("[name=ape1]").val() + " " + $("[name=ape2]").val() + " " + $("[name=nom1]").val() + " " + $("[name=nom2]").val())
		}
		$("[name=cpersona]").change(function() {
			if($(this).val() == "PN"){
				$("[name=ape1],[name=ape2],[name=nom1],[name=nom2]").attr("disabled",false);
				$("[name=ape1],[name=ape2],[name=nom1],[name=nom2]").on("change",setRasocial);

				$("[name=cregiva]").val(1);
			}else if($(this).val() == "PJ"){
				$("[name=ape1],[name=ape2],[name=nom1],[name=nom2]").attr("disabled",true);
				$("[name=ape1],[name=ape2],[name=nom1],[name=nom2]").off("change",setRasocial);
				$("[name=ape1],[name=ape2],[name=nom1],[name=nom2]").val("");
				$("[name=rasocial]").val("");
				$("[name=cregiva]").val(2);
			}
		});
		customValidationFormTabs("form")
		$('.date').datetimepicker({
			format: 'YYYY-MM-D',
		});
		$("[name=idterce]").change(function(){$("[name=dv]").val(calcularDigitoVerificacion(this.value))})
	</script>
{%endblock%}
