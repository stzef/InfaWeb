{%extends 'layouts/base.html'%}

{%block content%}
	{%include 'elements/nav.html'%}
	{%include 'elements/sidebar.html'%}
	<div class="content-wrapper" style="min-height: 921px;">
	<section class="content">
		<div class="row">
			<div class="col-md-12">

				<div class="box box-primary">
					<div class="box-header with-border">
						<h3 class="box-title">Nueva Zona</h3>
					</div>

					<form action="" method="POST" role="form" class="form-horizontal">
						{%csrf_token%}
						<div class="box-body">
							<section class="row col-md-12">
								<div class="col-md-8 form-group">
									<label for="{{form.nruta.id_for_label}}" class="col-sm-2 control-label">{{form.nruta.label}}</label>
									{%if form.nruta.errors%}
									{{form.nruta.errors}}
									{%endif%}
									<div class="col-sm-10">
										{{form.nruta}}
									</div>
								</div>
								<div class="form-group">
									<label for="{{form.cesdo.id_for_label}}" class="col-sm-2 control-label">{{form.cesdo.label}}</label>
									{%if form.cesdo.errors%}
									{{form.cesdo.errors}}
									{%endif%}
									<div class="col-sm-10">
										<div class="input-group">
											{{form.cesdo}}
											<span class="input-group-addon"><a data-new-window href="{% url 'add-state' %}" target="_blank"><i class="fa fa-plus-square"></i></a></span>
										</div>
									</div>
								</div>
							</section>
							<div class="btn-group">
								<button class="btn btn-app" type="submit">
									<i class="fa fa-plus-square-o"></i>Guardar
								</button>
								<a data-new-window class="btn btn-app" href="{% url 'list-third-parties' %}"><i class="fa fa-list"></i>Listar</a>
							</div>
						</div>
					</form>
				</div>
			</div>
		</div>
	</section>
	</div>
	{%include 'elements/footer.html'%}
{%endblock%}

{% block content_script %}
	<script>
			$("form").submit(function(event){
				event.preventDefault()
				$.ajax({
					{% if mode_view == "edit" %}
						url: '{% url 'edit-route' current_pk %}',
					{% elif mode_view == "create" %}
						url: '{% url 'add-route' %}',
					{% else %}
						url: '',
					{% endif %}
					type: 'POST',
					data: $("form").serialize(),
					contentType: "application/x-www-form-urlencoded",
					success: function(response){
						var object = JSON.parse(response.object)[0]
						var fields = object.fields
						if(window.opener){
							window.opener.$("select[name=cruta")
								.append($("<option>",{value:response.pk,html:fields.nruta}).attr("selected",true))
								.focus()
							window.close()
						}
					}
				});
			})
	</script>
{%endblock%}
