{% extends "m/base.html" %}

{% block title %}
	<h1 class="ui-title" role="heading" aria-level="1">Facturaci√≥n</h1>
{% endblock title %}

{% block header %}
	{% include "m/m_header_fac.html" %}
	<a href="{% url 'm_pay' %}" class="ui-btn-right ui-btn ui-icon-gear ui-shadow ui-corner-all" data-role="button" data-transition="slide" role="button" id="pay">Pagar</a>
{% endblock header %}

{% block content %}

	<h4>Incluye los articulos del pedido</h4>

	<a href="{% url 'm_choose_article' %}" class="ui-btn" data-transition="slide">Seleccionar Articulo</a>

	<table data-role="table" data-mode="columntoggle" data-column-btn-text="columnas..." class="ui-responsive table-stroke">
		<thead>
		<tr>
			<th data-priority="3">cod</th>
			<th>Articulo</th>
			<th>Cant.</th>
			<th data-priority="1">Desc. %</th>
			<th data-priority="2">v. Unitario</th>
			<th>v. Total</th>
		</tr>
		</thead>
		<tbody id="articleTableBody">
			
		</tbody>
	</table>

	<div data-role="footer" data-position="fixed" role="contentinfo" class="ui-footer ui-bar-inherit ui-footer-fixed slideup">
		<div class="ui-grid-a" style="text-align:center;">
			<div class="ui-block-a">
				<h3>TOTAL $</h3>
			</div>
			<div class="ui-block-b">
				<input id="vtotalFactura" type="number" value="0" style="text-align:right;background-color: black;color: white;font-size: 20px;" disabled>
			</div>
		</div>
	</div>
	<script>

		var vtotalFactura = 0;

		$( "#pay" ).on( "click", function( event ) {

			event.preventDefault();

			// Validar si existen articulos cargados a la factura antes de pagar
			if ( articlesOrder.length > 0){
				$.mobile.navigate( 
					$(this).attr("href"), 
					{ transition: "slide"}
				);
			}
			else {
				// mostrar dialogo
				alert("Primero debes cargar articulos a la factura")
			}


		});

		var templateArticleList = "<tr>" +
				"<td>:carlo:</td>" +
				"<td>:ncorto:</td>" +
				"<td>:cantidad:</td>" +
				"<td>:descuento:</td>" +
				"<td>:vunitario:</td>" +
				"<td>:vtotal:</td>" +
			"</tr>"

		// recorrer lista de articulos
		if ( articlesOrder.length > 0) {

			var t = "";
			var totalPedido = 0

			// armar template
			for (var i = 0; i < articlesOrder.length; i++) {
				t += templateArticleList
								.replace(":carlo:", articlesOrder[i].carlo)
								.replace(":ncorto:", articlesOrder[i].ncorto)
								.replace(":cantidad:", articlesOrder[i].cantidad)
								.replace(":descuento:", articlesOrder[i].descuento)
								.replace(":vunitario:", articlesOrder[i].vunitario)
								.replace(":vtotal:", articlesOrder[i].vtotal)

				totalPedido += articlesOrder[i].vtotal
				vtotalFactura = totalPedido

			}

			// renderizar template
			$("#articleTableBody").append(t)
			$("#vtotalFactura").val(vtotalFactura)
		}

	</script>
{% endblock content %}